<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>qdtsne: C++ library for t-SNE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">qdtsne
   </div>
   <div id="projectbrief">A quick and dirty t-SNE C++ library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">C++ library for t-SNE </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__github_workspace_README"></a> <img src="https://github.com/LTLA/qdtsne/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/LTLA/qdtsne/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <img src="https://github.com/LTLA/qdtsne/actions/workflows/compare-Rtsne.yaml/badge.svg" alt="Rtsne comparison" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/LTLA/qdtsne"><img src="https://codecov.io/gh/LTLA/qdtsne/branch/master/graph/badge.svg?token=CX6G39BM7B" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1>Overview</h1>
<p >This repository contains a header-only C++ library implementing the Barnes-Hut t-distributed stochastic neighbor embedding (t-SNE) algorithm (van der Maaten and Hinton, 2008; van der Maaten, 2014). t-SNE is a non-linear dimensionality reduction technique that enables visualization of complex datasets by placing each observation on a low-dimensional (usually 2D) map based on its neighbors. The general idea is that neighboring observations are placed next to each other, thus preserving the local structure of the dataset from its original high-dimensional form. The non-linear nature of the algorithm gives it the flexibility to accommodate complicated structure that is not possible in linear techniques like PCA.</p>
<p >The code here is derived from the C++ code in the <a href="https://github.com/jkrijthe/Rtsne/"><b>Rtsne</b> R package</a>, itself taken from the 2014 paper. It has been updated to use more modern C++, along with some additional options to sacrifice accuracy for speed - see below for details.</p>
<h1>Quick start</h1>
<p >Using this library is as simple as including the header file in your source code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="qdtsne_8hpp.html">qdtsne/qdtsne.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> Y = <a class="code hl_function" href="utils_8hpp.html#aac440bd84565b633afd95352c01ff235">qdtsne::initialize_random</a>(N); <span class="comment">// initial coordinates</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Assuming `data` contains high-dimensional data in column-major format,</span></div>
<div class="line"><span class="comment"> * i.e., each column is a observation and each row is a dimension.</span></div>
<div class="line"><span class="comment"> * This fills `Y` in column-major format where each row is a dimension </span></div>
<div class="line"><span class="comment"> * (defaulting to 2 dimensions) and each column is an observation.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><a class="code hl_class" href="classqdtsne_1_1Tsne.html">qdtsne::Tsne</a> thing;</div>
<div class="line"><span class="keyword">auto</span> ref = thing.<a class="code hl_function" href="classqdtsne_1_1Tsne.html#a90a9f9cf6ed48a8449ad372057464528">run</a>(data.data(), D, N, Y.data());</div>
<div class="ttc" id="aclassqdtsne_1_1Tsne_html"><div class="ttname"><a href="classqdtsne_1_1Tsne.html">qdtsne::Tsne</a></div><div class="ttdoc">Implements the t-SNE algorithm.</div><div class="ttdef"><b>Definition:</b> tsne.hpp:84</div></div>
<div class="ttc" id="aclassqdtsne_1_1Tsne_html_a90a9f9cf6ed48a8449ad372057464528"><div class="ttname"><a href="classqdtsne_1_1Tsne.html#a90a9f9cf6ed48a8449ad372057464528">qdtsne::Tsne::run</a></div><div class="ttdeci">auto run(NeighborList&lt; Index, Float &gt; nn, Float *Y)</div><div class="ttdef"><b>Definition:</b> tsne.hpp:449</div></div>
<div class="ttc" id="aqdtsne_8hpp_html"><div class="ttname"><a href="qdtsne_8hpp.html">qdtsne.hpp</a></div><div class="ttdoc">Umbrella header for all qdtsne files.</div></div>
<div class="ttc" id="autils_8hpp_html_aac440bd84565b633afd95352c01ff235"><div class="ttname"><a href="utils_8hpp.html#aac440bd84565b633afd95352c01ff235">qdtsne::initialize_random</a></div><div class="ttdeci">void initialize_random(Float *Y, size_t N, int seed=42)</div><div class="ttdef"><b>Definition:</b> utils.hpp:52</div></div>
</div><!-- fragment --><p >You can change the parameters with the relevant setters:</p>
<div class="fragment"><div class="line">thing.<a class="code hl_function" href="classqdtsne_1_1Tsne.html#a506e7e8dbfa46987df102acb6d42d3c2">set_perplexity</a>(10).<a class="code hl_function" href="classqdtsne_1_1Tsne.html#ae5b668da0dadbbdceeb19594b8e5897d">set_mom_switch_iter</a>(100);</div>
<div class="line">thing.<a class="code hl_function" href="classqdtsne_1_1Tsne.html#a90a9f9cf6ed48a8449ad372057464528">run</a>(data.data(), D, N, Y.data());</div>
<div class="ttc" id="aclassqdtsne_1_1Tsne_html_a506e7e8dbfa46987df102acb6d42d3c2"><div class="ttname"><a href="classqdtsne_1_1Tsne.html#a506e7e8dbfa46987df102acb6d42d3c2">qdtsne::Tsne::set_perplexity</a></div><div class="ttdeci">Tsne &amp; set_perplexity(Float p=Defaults::perplexity)</div><div class="ttdef"><b>Definition:</b> tsne.hpp:270</div></div>
<div class="ttc" id="aclassqdtsne_1_1Tsne_html_ae5b668da0dadbbdceeb19594b8e5897d"><div class="ttname"><a href="classqdtsne_1_1Tsne.html#ae5b668da0dadbbdceeb19594b8e5897d">qdtsne::Tsne::set_mom_switch_iter</a></div><div class="ttdeci">Tsne &amp; set_mom_switch_iter(int m=Defaults::mom_switch_iter)</div><div class="ttdef"><b>Definition:</b> tsne.hpp:191</div></div>
</div><!-- fragment --><p >You can also stop and start the algorithm:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classqdtsne_1_1Tsne.html">qdtsne::Tsne</a> thing;</div>
<div class="line"><span class="keyword">auto</span> ref = thing.<a class="code hl_function" href="classqdtsne_1_1Tsne.html#a8e74b496ef8be5ad02153abdbb88ac11">initialize</a>(data.data(), D, N);</div>
<div class="line">thing.<a class="code hl_function" href="classqdtsne_1_1Tsne.html#a90a9f9cf6ed48a8449ad372057464528">run</a>(ref, Y.data());</div>
<div class="line">thing.<a class="code hl_function" href="classqdtsne_1_1Tsne.html#a1ada1a41bf0c2f87a091bfa416e321e8">set_max_iter</a>(1100).<a class="code hl_function" href="classqdtsne_1_1Tsne.html#a90a9f9cf6ed48a8449ad372057464528">run</a>(ref, Y.data()); <span class="comment">// run for more iterations</span></div>
<div class="ttc" id="aclassqdtsne_1_1Tsne_html_a1ada1a41bf0c2f87a091bfa416e321e8"><div class="ttname"><a href="classqdtsne_1_1Tsne.html#a1ada1a41bf0c2f87a091bfa416e321e8">qdtsne::Tsne::set_max_iter</a></div><div class="ttdeci">Tsne &amp; set_max_iter(int m=Defaults::max_iter)</div><div class="ttdef"><b>Definition:</b> tsne.hpp:173</div></div>
<div class="ttc" id="aclassqdtsne_1_1Tsne_html_a8e74b496ef8be5ad02153abdbb88ac11"><div class="ttname"><a href="classqdtsne_1_1Tsne.html#a8e74b496ef8be5ad02153abdbb88ac11">qdtsne::Tsne::initialize</a></div><div class="ttdeci">auto initialize(NeighborList&lt; Index, Float &gt; nn)</div><div class="ttdef"><b>Definition:</b> tsne.hpp:405</div></div>
</div><!-- fragment --><p >See the <a href="https://ltla.github.io/qdtsne/">reference documentation</a> for more details.</p>
<h1>Building projects</h1>
<p >If you're already using CMake, you can add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  qdtsne </div>
<div class="line">  GIT_REPOSITORY https://github.com/LTLA/qdtsne</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(qdtsne)</div>
</div><!-- fragment --><p >And then:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe qdtsne)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE qdtsne)</div>
</div><!-- fragment --><p >Otherwise, you can just copy the header files in <code>include/</code> into some location that is visible to your compiler. This requires the manual inclusion of a few dependencies:</p>
<ul>
<li>The <a href="https://github.com/LTLA/knncolle"><b>knncolle</b></a> library for nearest neighbor search. If you are instead supplying your own neighbor search, this dependency can be eliminated by defining the <code>QDTSNE_CUSTOM_NEIGHBORS</code> macro.</li>
<li>The <a href="https://github.com/LTLA/aarand"><b>aarand</b></a> library for random distribution functions.</li>
</ul>
<h1>Approximations for speed</h1>
<p >The Barnes-Hut implementation (inherited from the 2014 paper) speeds up the algorithm by approximating the repulsive forces. Specifically, the algorithm consolidates a group of distant points into a single center of mass, avoiding the need to calculate forces between individual points. The definition of "distant" is determined by the <code>theta</code> parameter, where larger values sacrifice accuracy for speed. However, it must be said that the default <code>theta</code> is already appropriate in most settings; further increases may result in a noticeable deterioration in the visualization.</p>
<p >We have introduced an extra <code>max_depth</code> parameter that bounds the depth of the quad trees used for the Barnes-Hut force calculations. All nodes at the maximum depth are designated as leaf nodes; if multiple observations are present, they are aggregated into the center of mass for that node. This provides an upper bound on the runtime of the force calculation for each observation, e.g., a maximum depth of 7 means that there can be no more than 16384 leaf nodes. Some timings with <code>gallery/speedtest.cpp</code> suggest that a moderate improvement in run-time is possible; without any approximation, the iterations take 114 ± 1 seconds, while with <code>max_depth = 7</code>, the iterations take 85 ± 2 seconds.</p>
<p >We have also added an <code>interpolation</code> parameter that instructs the library to interpolate the repulsive forces for each observations. Specifically, it divides up the bounding box for the current embedding into a grid of length equal to <code>interpolation</code> in each dimension. We compute the repulsive forces at each grid point and perform linear interpolation to obtain the force at each point inside the grid. This offers a large speed-up when the number of observations is much greater than the number of possible grid points. We suggest using a grid resolution of 200 to ensure that artificial "edge effects" from interpolation are not visible. (This implies that the dataset must have more than 40000 observations for the interpolation to provide any speed benefit.)</p>
<p >Of course, users can enable OpenMP to throw more threads at the problem. With 4 threads and <code>max_depth</code> set as above, the iterations go down to 27 seconds. The results are agnostic to the choice of parallelization, i.e., you can get the same results with or without using OpenMP.</p>
<h1>References</h1>
<p >van der Maaten, L.J.P. and Hinton, G.E. (2008). Visualizing high-dimensional data using t-SNE. <em>Journal of Machine Learning Research</em>, 9, 2579-2605.</p>
<p >van der Maaten, L.J.P. (2014). Accelerating t-SNE using tree-based algorithms. <em>Journal of Machine Learning Research</em>, 15, 3221-3245. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
